<!DOCTYPE html>
<html>
<head>
    <title>Test Image Upload</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .status { margin-top: 20px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Test Image Upload - Cache Buster</h1>
    <p>This page bypasses any cached JavaScript to test the API directly</p>

    <form id="uploadForm">
        <input type="file" id="fileInput" accept="image/*" required>
        <button type="submit">Upload Image</button>
    </form>

    <div id="status"></div>

    <script>
        document.getElementById('uploadForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const fileInput = document.getElementById('fileInput');
            const status = document.getElementById('status');
            const file = fileInput.files[0];

            if (!file) {
                status.className = 'status error';
                status.textContent = 'Please select a file';
                return;
            }

            status.className = 'status';
            status.textContent = 'Uploading...';

            try {
                const formData = new FormData();
                formData.append('file', file);

                console.log('Uploading to:', '/api/admin/media');
                console.log('File:', file.name, file.size, 'bytes');

                const response = await fetch('/api/admin/media', {
                    method: 'POST',
                    body: formData
                });

                console.log('Response status:', response.status);
                console.log('Response headers:', Object.fromEntries(response.headers.entries()));

                const data = await response.json();
                console.log('Response data:', data);

                if (response.ok) {
                    status.className = 'status success';
                    status.innerHTML = `
                        <strong>Success!</strong><br>
                        ID: ${data.doc.id}<br>
                        URL: ${data.doc.url}<br>
                        Filename: ${data.doc.filename}
                    `;
                } else {
                    status.className = 'status error';
                    status.innerHTML = `
                        <strong>Error ${response.status}</strong><br>
                        ${data.error || 'Unknown error'}<br>
                        ${data.message ? 'Message: ' + data.message : ''}
                    `;
                }
            } catch (error) {
                console.error('Upload error:', error);
                status.className = 'status error';
                status.textContent = 'Error: ' + error.message;
            }
        });
    </script>
</body>
</html>
